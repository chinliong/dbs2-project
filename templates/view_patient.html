{% extends 'base.html' %}
{% block content %}

<h1>Patient Information</h1>

{% if patient %}
    <h2>{{ patient['PatientName'] }}</h2>
    <h3>Appointment ID: {{ appt_id }}</h3>

    <form method="POST">
        <div class="mb-3">
            <label for="diagnosis">Diagnosis:</label>
            <input type="text" class="form-control" id="diagnosis" name="diagnosis" required>
        </div>

        <div class="mb-3">
            <label for="notes">Notes:</label>
            <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
    </form>

    <h3>Past Diagnoses</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Diagnosis</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for record in history %}
            <tr>
                <td>{{ record['date'] if record['date'] else 'N/A' }}</td>
                <td>{{ record['diagnosis'] }}</td>
                <td>{{ record['notes'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Prescribe Medication</h3>
    <form method="POST">
        <div class="mb-3">
            <label for="medication">Medication:</label>
            <input type="text" class="form-control" id="medication" name="medication" required>
        </div>

        <div class="mb-3">
            <label for="duration">Quantity:</label>
            <input type="number" class="form-control" id="duration" name="duration" required>
        </div>

        <div class="mb-3">
            <label for="med_notes">Medication Instructions:</label>
            <textarea class="form-control" id="med_notes" name="notes" rows="3"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Prescribe</button>
    </form>

    <h3>Past Prescriptions</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Prescription ID</th>
                <th>Medication Name</th>
                <th>Dispensed Quantity</th>
                <th>Instructions</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for prescription in prescriptions %}
            <tr>
                <td>{{ prescription['prescription_id'] }}</td>
                <td>{{ prescription['medication_name'] }}</td>
                <td>{{ prescription['dosage'] }}</td>
                <td>{{ prescription['notes'] }}</td>
                <td>{{ prescription['date'] if prescription['date'] else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <form action="{{ url_for('staff.complete_appointment', appt_id=appt_id) }}" method="POST">
        <button type="submit" class="btn btn-success">Complete Appointment</button>
    </form>

{% else %}
    <div class="alert alert-danger">Patient not found.</div>
{% endif %}

{% endblock %}